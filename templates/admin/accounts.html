{% extends "admin/base.html" %}

{% block title %}Account Management - Config Admin{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <h1 style="color: #2c3e50; margin-bottom: 30px;">
        Account Management
        <a href="{{ url_for('index') }}" style="float: right; font-size: 16px; color: #3498db; text-decoration: none;">
            ← Back to Config
        </a>
    </h1>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
        <h3 style="margin-top: 0; color: #e74c3c;">⚠️ Warning</h3>
        <p>Resetting an account will permanently delete:</p>
        <ul>
            <li>All transaction history</li>
            <li>All NAV history</li>
            <li>All benchmark data</li>
            <li>Processing status</li>
        </ul>
        <p><strong>Account configuration and API keys will be preserved.</strong></p>
    </div>
    
    {% if accounts %}
    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <thead>
            <tr style="background: #3498db; color: white;">
                <th style="padding: 15px; text-align: left;">Account Name</th>
                <th style="padding: 15px; text-align: left;">Account ID</th>
                <th style="padding: 15px; text-align: center;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for account in accounts %}
            <tr style="border-bottom: 1px solid #ecf0f1;">
                <td style="padding: 15px;">
                    <strong>{{ account.account_name }}</strong>
                </td>
                <td style="padding: 15px; font-family: monospace; font-size: 12px; color: #7f8c8d;">
                    {{ account.id }}
                </td>
                <td style="padding: 15px; text-align: center;">
                    <button 
                        onclick="resetAccount('{{ account.id }}', '{{ account.account_name }}')"
                        style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;"
                        onmouseover="this.style.background='#c0392b'"
                        onmouseout="this.style.background='#e74c3c'"
                    >
                        Reset Account
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="background: #f8f9fa; padding: 40px; text-align: center; border-radius: 8px;">
        <p style="color: #7f8c8d; margin: 0;">No accounts found in the database.</p>
    </div>
    {% endif %}
</div>

<script>
function resetAccount(accountId, accountName) {
    if (!confirm(`Are you sure you want to reset the account '${accountName}'?\n\nThis will permanently delete all historical data for this account.`)) {
        return;
    }
    
    // Show loading state
    const button = event.target;
    const originalText = button.textContent;
    button.disabled = true;
    button.textContent = 'Resetting...';
    
    fetch(`/accounts/reset/${accountId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            // Optionally reload the page to show updated state
            window.location.reload();
        } else {
            alert(`Error: ${data.error}`);
        }
    })
    .catch(error => {
        alert(`Error: ${error.message}`);
    })
    .finally(() => {
        button.disabled = false;
        button.textContent = originalText;
    });
}
</script>
{% endblock %}